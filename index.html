<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuvercinIhale | Canlı Sistem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">

    <nav class="bg-blue-900 p-4 text-white flex justify-between items-center shadow-lg">
        <h1 onclick="location.reload()" class="font-black text-xl cursor-pointer">GUVERCİNİHALE</h1>
        <div id="userStatus" class="text-xs font-bold">
            <button onclick="showPage('login')" class="bg-blue-600 px-3 py-1 rounded-full">GİRİŞ / ÜYE OL</button>
        </div>
        <button onclick="adminLogin()" class="fixed bottom-4 right-4 opacity-10 text-black">●</button>
    </nav>

    <div id="home" class="p-4 container mx-auto max-w-md">
        <div id="ihaleCard" class="bg-white rounded-3xl shadow-xl overflow-hidden border">
            <img src="https://images.unsplash.com/photo-1509121504107-5999059f0f9c?w=400" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="font-bold text-2xl uppercase tracking-tighter" id="kusCinsi">Mavi Şebap</h3>
                <div class="flex justify-between items-end mt-4">
                    <div>
                        <p class="text-gray-400 text-xs font-bold uppercase">Güncel Teklif</p>
                        <p class="text-3xl font-black text-blue-800" id="currentBid">0 TL</p>
                    </div>
                    <button onclick="checkAndBid()" class="bg-blue-800 text-white px-6 py-3 rounded-2xl font-bold shadow-lg active:scale-95 transition-all">TEKLİF VER</button>
                </div>
            </div>
        </div>
    </div>

    <div id="login" class="hidden p-6 container mx-auto max-w-md">
        <div class="bg-white p-8 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-black mb-6 text-blue-900">Kayıt Ol</h2>
            <input type="text" id="uName" placeholder="Ad Soyad" class="w-full border p-4 rounded-2xl mb-3 bg-gray-50 outline-none">
            <input type="tel" id="uPhone" placeholder="Telefon (05xx...)" class="w-full border p-4 rounded-2xl mb-4 bg-gray-50 outline-none">
            <button onclick="handleRegister()" class="w-full bg-blue-800 text-white py-4 rounded-2xl font-bold">SİSTEME GİRİŞ YAP</button>
        </div>
    </div>

    <div id="admin" class="hidden p-4 container mx-auto max-w-md">
        <div class="bg-white p-6 rounded-3xl shadow-2xl border-4 border-red-600">
            <h2 class="text-xl font-black text-red-600 mb-4 tracking-tighter italic uppercase text-center">Patron Kontrol Paneli</h2>
            <div class="space-y-4">
                <button onclick="fetchUsers()" class="w-full bg-black text-white py-3 rounded-xl font-bold">ÜYELERİ VE TELEFONLARI LİSTELE</button>
                <div id="userList" class="text-xs bg-gray-50 p-3 rounded-lg max-h-40 overflow-y-auto hidden border"></div>
                <button onclick="alert('İhale Sonlandırıldı. Kazanan kişiye SMS gönderiliyor...')" class="w-full bg-red-600 text-white py-3 rounded-xl font-bold italic">İHALEYİ BİTİR (STOP)</button>
            </div>
        </div>
    </div>

    <script>
        // BURAYI KENDİ BİLGİLERİNLE DOLDUR
        const SUPABASE_URL = 'https://zfhbbvnyceagummhcjis.supabase.co';
        const SUPABASE_KEY = 'process.env.SUPABASE_KEY
const supabase = createClient(supabaseUrl, supabaseKey)'; // <--- API KEY'İ BURAYA YAPIŞTIR!
        
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let user = JSON.parse(localStorage.getItem('guser')) || null;

        if(user) {
            document.getElementById('userStatus').innerHTML = `<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full uppercase font-black">${user.isim}</span>`;
        }

        function showPage(id) {
            ['home', 'login', 'admin'].forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        async function handleRegister() {
            const isim = document.getElementById('uName').value;
            const tel = document.getElementById('uPhone').value;
            if(!isim || !tel) return alert("Bilgileri gir!");

            const { error } = await _supabase.from('uyeler').insert([{ isim: isim, telefon: tel }]);
            if(error) return alert("Hata: " + error.message);

            user = { isim, tel };
            localStorage.setItem('guser', JSON.stringify(user));
            alert("Kayıt başarılı! Artık teklif verebilirsin.");
            location.reload();
        }

        function checkAndBid() {
            if(!user) {
                alert("Teklif vermek için önce kayıt olmalısın!");
                showPage('login');
            } else {
                let miktar = prompt("Teklif miktarını girin (TL):");
                if(miktar) alert("Teklifiniz alındı! Veritabanına işleniyor...");
            }
        }

        async function fetchUsers() {
            const { data, error } = await _supabase.from('uyeler').select('*');
            const listDiv = document.getElementById('userList');
            listDiv.classList.remove('hidden');
            if(data) {
                listDiv.innerHTML = data.map(u => `<div class="border-b py-1"><b>${u.isim}</b>: ${u.telefon}</div>`).join('');
            }
        }

        function adminLogin() {
            if(prompt("Şifre?") === "guvercin123") showPage('admin');
        }
    </script>
</body>
</html>
